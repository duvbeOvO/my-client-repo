<script>
    const config = {
        owner: "duvbeOvO",
        repo: "my-client-repo",
        path: "main/config/verified_players.txt", // 配合你的路徑，保留 main/ 資料夾 
        branch: "main"
    };
    let currentSha = "";
    let playerList = [];

    // 讀取名單
    async function loadList() {
        const token = document.getElementById('token').value.trim();
        const status = document.getElementById('status');
        if(!token) return alert("請輸入 Token 進行驗證！");

        status.innerText = "驗證並載入中...";
        const url = `https://api.github.com/repos/${config.owner}/${config.repo}/contents/${config.path}?ref=${config.branch}`;
        
        try {
            const res = await fetch(url, {
                headers: { "Authorization": `token ${token}` }
            });
            const data = await res.json();
            if (data.sha) {
                currentSha = data.sha;
                const content = decodeURIComponent(escape(atob(data.content)));
                playerList = content.split('\n').filter(line => line.trim() !== "");
                renderTable();
                document.getElementById('adminPanel').style.display = "block";
                status.innerText = "讀取成功！";
            } else {
                throw new Error("找不到檔案路徑");
            }
        } catch (err) {
            alert("讀取失敗，請確認 Token 是否正確！");
            status.innerText = "驗證失敗";
        }
    }

    // 同步到雲端 [cite: 1, 10]
    async function updateGitHub(msg) {
        const token = document.getElementById('token').value.trim();
        const status = document.getElementById('status');
        const url = `https://api.github.com/repos/${config.owner}/${config.repo}/contents/${config.path}`;
        
        status.innerText = "同步中...";
        const newContent = playerList.join('\n');
        const encodedContent = btoa(unescape(encodeURIComponent(newContent)));

        const res = await fetch(url, {
            method: "PUT",
            headers: { 
                "Authorization": `token ${token}`,
                "Accept": "application/vnd.github.v3+json" 
            },
            body: JSON.stringify({
                message: msg,
                content: encodedContent,
                sha: currentSha,
                branch: config.branch
            })
        });

        if(res.ok) {
            const data = await res.json();
            currentSha = data.content.sha;
            renderTable();
            status.innerText = "同步成功！";
        } else {
            alert("同步失敗，請檢查權限！");
        }
    }
    
    // 渲染表格 (保持原樣即可)
    function renderTable() {
        const body = document.getElementById('listBody');
        body.innerHTML = "";
        playerList.forEach((line, index) => {
            const parts = line.split(':');
            body.innerHTML += `
                <tr>
                    <td><b>${parts[0]}</b></td>
                    <td><span class="tag">顏色: ${parts[1]||'f'}</span> <span class="tag">${parts[2]||'無'}</span></td>
                    <td><button class="del-btn" onclick="deletePlayer(${index})">刪除</button></td>
                </tr>
            `;
        });
    }
</script>
